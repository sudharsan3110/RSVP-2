generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  id                        String     @id @default(uuid()) @db.VarChar(36)
  primaryEmail              String     @map("primary_email") @db.VarChar(100)
  secondaryEmail            String?    @map("secondary_email") @db.VarChar(100)
  contact                   String?    @map("contact") @db.VarChar(15)
  fullName                  String?    @map("full_name") @db.VarChar(50)
  userName                  String?    @unique @map("user_name") @db.VarChar(50)
  magicToken                String?    @unique @map("magic_token") @db.VarChar(100)
  refreshToken              String?    @unique @map("refresh_token") @db.VarChar(512)
  isCompleted               Boolean    @default(false) @map("is_completed")
  location                  String?    @map("location") @db.VarChar(100)
  bio                       String?    @map("bio") @db.VarChar(500)
  twitter                   String?    @map("twitter") @db.VarChar(50)
  instagram                 String?    @map("instagram") @db.VarChar(50)
  website                   String?    @map("website") @db.VarChar(50)
  profileIcon               Int        @map("profile_icon") @default(1)
  eventParticipationEnabled Boolean    @default(false) @map("event_participation_enabled")
  isDeleted                 Boolean    @default(false) @map("is_deleted")
  createdAt                 DateTime   @default(now()) @map("created_at")
  updatedAt                 DateTime   @updatedAt @map("updated_at")

  events                    Event[]
  attendees                 Attendee[]
  cohosts                   Cohost[]
  updates                   Update[]

  @@map("users")
}

model Update {
  id                        String    @id @default(uuid()) @db.VarChar(36)
  userId                    String    @map("user_id") @db.VarChar(36)
  eventId                   String    @map("event_id") @db.VarChar(36)
  content                   String    @map("content") @db.VarChar(1000)
  isNotification            Boolean   @default(false) @map("is_notification")
  scheduledNotificationTime DateTime? @map("scheduled_notification_time")
  isDeleted                 Boolean   @default(false) @map("is_deleted")
  createdAt                 DateTime  @default(now()) @map("created_at")
  updatedAt                 DateTime  @updatedAt @map("updated_at")

  event                     Event     @relation("EventUpdates", fields: [eventId], references: [id], onDelete: Cascade)
  user                      Users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("updates")
}

model Event {
  id                        String     @id @default(uuid()) @db.VarChar(36)
  creatorId                 String     @map("creator_id") @db.VarChar(36)
  name                      String     @map("name") @db.VarChar(100)
  slug                      String     @unique @map("slug") @db.VarChar(100)
  category                  String?    @map("category") @db.VarChar(36)
  startTime                 DateTime   @map("start_time")
  endTime                   DateTime   @map("end_time")
  eventDate                 DateTime   @map("event_date")
  description               String?    @map("description") @db.VarChar(1000)
  eventImageUrl             String?    @map("event_image_url") @db.VarChar(256)
  venueType                 VenueType  @map("venue_type")
  venueAddress              String?    @map("venue_address") @db.VarChar(256)
  venueUrl                  String?    @map("venue_url") @db.VarChar(256)
  hostPermissionRequired    Boolean    @map("host_permission_required")
  capacity                  Int?       @map("capacity")
  isActive                  Boolean    @default(true) @map("is_active")
  isDeleted                 Boolean    @default(false) @map("is_deleted")
  sendReminderEmail         Boolean    @default(false)
  createdAt                 DateTime   @default(now()) @map("created_at")
  updatedAt                 DateTime   @updatedAt @map("updated_at")
  
  creator                   Users      @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  updates                   Update[]   @relation("EventUpdates")
  attendees                 Attendee[] @relation("EventAttendees")
  cohosts                   Cohost[]   @relation("EventCohosts")

  @@map("events")
}

model Attendee {
  id                        String    @id @default(uuid()) @db.VarChar(36)
  userId                    String    @map("user_id") @db.VarChar(36)
  eventId                   String    @map("event_id") @db.VarChar(36)
  registrationTime          DateTime  @default(now()) @map("registration_time")
  hasAttended               Boolean   @default(false) @map("has_attended")
  checkInTime               DateTime? @map("check_in_time")
  feedback                  String?   @map("feedback") @db.VarChar(100)
  qrToken                   String    @unique @map("qr_token") @db.VarChar(100)
  status                    Status    @default(WAITING) @map("status")
  allowedStatus             Boolean   @default(true) @map("allowed_status")
  isDeleted                 Boolean    @default(false) @map("is_deleted")
  createdAt                 DateTime   @default(now()) @map("created_at")
  updatedAt                 DateTime   @updatedAt @map("updated_at")

  user                      Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event                     Event     @relation("EventAttendees", fields: [eventId], references: [id], onDelete: Cascade)
  
  @@unique([eventId, userId])
  @@map("attendees")
}

model Cohost {
  id                        String   @id @default(uuid()) @db.VarChar(36)
  userId                    String   @map("user_id") @db.VarChar(36)
  eventId                   String   @map("event_id") @db.VarChar(36)
  role                      Role     @default(READ_ONLY) @map("role")
  isDeleted                 Boolean  @default(false) @map("is_deleted")
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")

  user                      Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  event                     Event    @relation("EventCohosts", fields: [eventId], references: [id], onDelete: Cascade)

  @@map("cohosts")
}

enum Status {
  GOING    @map("1")
  NOT_GOING @map("2")
  WAITING  @map("3")
  PENDING  @map("4")
  INVITED  @map("5")
  CANCELLED @map("6")
}

enum Role {
  CREATOR   @map("1")
  MANAGER   @map("2")
  READ_ONLY  @map("3")
  CELEBRITY @map("4")
}

enum VenueType {
  PHYSICAL
  VIRTUAL
  LATER
}